syntax = "proto3";

package external;

option go_package = "github.com/yb2020/odoc-proto/gen/go/external";

/**
 *	接口描述: 通过url下载文件
 *	接口url: /services/external/downloadFileByUrl
 *	接口请求方式: POST
 *	参数格式:application/json
 */
message DownloadFileByUrlReq {
  string serviceName = 1;
  string downloadToken = 2;
  string downloadUrl = 3;
}

message DownloadFileByUrlResp {
  
}

/**
 *	接口描述: 通过下载token获取文件下载状态
 *	接口url: /services/external/getDownloadStatus
 *	接口请求方式: POST
 *	参数格式:application/json
 */
message GetDownloadProgressReq{ 
    string downloadToken = 1;
}

message GetDownloadProgressResp {
  string downloadToken = 1;
  FileStatus downloadStatus = 2;
  string fileMd5 = 3;
}


//文件状态
enum FileStatus {
    //准备
    READ = 0;
    // 下载中
    DOWNLOADING = 1;
    //下载完成
    DOWNLOAD_COMPLETED = 2;
    //下载失败
    DOWNLOAD_FAIL = 3;

}

/**
 *	接口描述: 接收七牛云的上传信息接口
 *	接口url: /services/external/receiveQiniuUploadInfo
 *	接口请求方式: POST
 *	参数格式:application/json
 */
message ReceiveQiniuUploadInfoReq {
    string downloadToken = 1;
    FileStatus downloadStatus = 2;
    string fileMd5 = 3;
    QiniuUploadInfo uploadTokenInfo = 4;
}

message ReceiveQiniuUploadInfoResp {
    string downloadToken = 1;
    string fileMd5 = 2;
}

message QiniuUploadInfo {
    bool needUpload = 1;
    // 用来解除冲突的token
    string conflictToken = 2;
    // 用来上传文件的token
    string uploadToken = 3;
    // 用来查询文件创建状态的token
    string queryStatusToken = 4;
}